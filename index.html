// ----------------------------------------------------------------
// WARNING: Replace the ENTIRE SCRIPT block below with this one
// ----------------------------------------------------------------
    <script>
        // === CONFIGURATION START ===
        
        // 1. CRITICAL CHANGE: The custom SPARQL endpoint URL is wrapped in a proxy
        const massslyEndpoint = 'https://query.masssly.wikibase.cloud/sparql';
        const endpointUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(massslyEndpoint)}`;

        // 2. ULTRA-SIMPLE TEST QUERY: Find the first 5 Items and their IDs (No Labels)
        // This is the simplest possible query to confirm the connection is fully working.
        const myQuery = `
            SELECT ?item
            WHERE {
              ?item a wikibase:Item .
            }
            LIMIT 5
        `;
        
        // === CONFIGURATION END ===

        async function fetchData() {
            const container = document.getElementById('results-container');
            const fullUrl = endpointUrl + '?query=' + encodeURIComponent(myQuery) + '&format=json';

            try {
                const response = await fetch(fullUrl);
                const data = await response.json();

                // üõë ROBUST CHECK FOR DATA STRUCTURE üõë
                if (!data || !data.results || !data.results.bindings) {
                    container.innerHTML = `<div class="error-message">
                        <h4>‚ùå SPARQL Query Failed Server-Side</h4>
                        <p>The query syntax likely contains an element (like prefixes or a service call) that the Masssly server rejects, causing it to return an invalid result structure.</p>
                        <p>Data Snippet Received: <code>${JSON.stringify(data).substring(0, 300)}...</code></p>
                    </div>`;
                    return;
                }
                
                const items = data.results.bindings;
                
                container.innerHTML = ''; 

                if(items.length === 0) {
                    container.innerHTML = '<p>‚úÖ Connection OK, but query returned 0 results. The Wikibase may have no Items.</p>';
                    return;
                }
                
                // Display Results (Adapted to only show Item ID, as we removed the label service)
                items.forEach(result => {
                    // Item URL is guaranteed to exist by the query
                    const link = result.item.value; 
                    const entityId = link.split('/').pop();

                    const cardHtml = `
                        <article class="card">
                            <div class="item-title">SUCCESS: Entity Found</div>
                            <div class="details">Raw URL: <strong>${link}</strong></div>
                            <div class="details">Entity ID: <strong>${entityId}</strong></div>
                            <a href="${link}" target="_blank" role="button" class="secondary" style="margin-top: 15px;">View Item ${entityId}</a>
                        </article>
                    `;
                    container.innerHTML += cardHtml;
                });

            } catch (error) {
                container.innerHTML = `<div class="error-message">
                    <h4>üö® General Fetch Error (Proxy/Network)</h4>
                    <p>Error fetching data: <strong>${error.message}</strong></p>
                </div>`;
            }
        }

        fetchData();
    </script>
